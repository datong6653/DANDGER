<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜å±é»å ±é¦¬ä»” - æ™ºæ…§é€šå ±ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            padding: 1rem;
        }
        
        .container {
            max-width: 48rem;
            margin: 0 auto;
            padding: 2rem 0;
        }
        
        .header-card {
            background: linear-gradient(135deg, #ff1744 0%, #d50000 100%);
            border-radius: 1.5rem;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 20px 40px -12px rgba(255, 23, 68, 0.6);
        }
        
        .form-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            padding: 2.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .section-divider {
            border-top: 2px solid #e5e7eb;
            margin: 2rem 0;
            padding-top: 2rem;
        }
        
        .input-field, .select-field, .textarea-field {
            width: 100%;
            padding: 1rem;
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            background-color: #f8fafc;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }
        
        .input-field:focus, .select-field:focus, .textarea-field:focus {
            outline: none;
            border-color: #2196f3;
            box-shadow: 0 0 0 4px rgba(33, 150, 243, 0.2);
            background-color: #ffffff;
        }
        
        .label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .required::after {
            content: " *";
            color: #ef4444;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #2196f3 0%, #1565c0 100%);
            color: white;
            padding: 1.25rem 2rem;
            border-radius: 0.75rem;
            border: none;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 10px 25px rgba(33, 150, 243, 0.5);
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.4);
        }
        
        .submit-btn:active {
            transform: translateY(-1px);
        }
        
        .success-message {
            background: linear-gradient(135deg, #00e676 0%, #00c853 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 1rem;
            text-align: center;
            font-weight: 600;
            display: none;
            margin-bottom: 2rem;
            box-shadow: 0 10px 25px rgba(0, 230, 118, 0.5);
        }
        
        .icon-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 3rem;
            height: 3rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .grid-responsive {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .urgency-high { border-left: 4px solid #ef4444; }
        .urgency-medium { border-left: 4px solid #f59e0b; }
        .urgency-low { border-left: 4px solid #10b981; }
        
        .share-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.5);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .share-notification.show {
            transform: translateX(0);
        }
        
        @media (max-width: 768px) {
            .container { padding: 1rem 0; }
            .form-container { padding: 1.5rem; }
            .header-card { padding: 1.5rem; }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- æ¨™é¡Œå€åŸŸ -->
    <div class="header-card">
        <div class="icon-badge">ğŸš¨</div>
        <h1 class="text-3xl font-bold text-white mb-2">é«˜å±é»å ±é¦¬ä»”</h1>
        <p class="text-red-100 text-lg">æ™ºæ…§é€šå ±ç³»çµ±<span class="bg-yellow-400 text-red-800 px-3 py-1 rounded-full font-bold text-sm ml-2 animate-pulse">å…§éƒ¨ç‰ˆ</span> - å®ˆè­·ç¤¾å€å®‰å…¨</p>
        
        <!-- åŠŸèƒ½æŒ‰éˆ• -->
        <div class="flex flex-wrap justify-center gap-3 mt-4">
            <button id="showFormBtn" class="bg-white bg-opacity-40 text-white px-4 py-2 rounded-lg font-medium hover:bg-opacity-30 transition-all">
                ğŸ“ æ–°å¢é€šå ±
            </button>
            <button id="showRecordsBtn" class="bg-white bg-opacity-20 text-white px-4 py-2 rounded-lg font-medium hover:bg-opacity-30 transition-all">
                ğŸ“‹ æŸ¥çœ‹è¨˜éŒ„
            </button>
            <button id="exportDataBtn" class="bg-white bg-opacity-20 text-white px-4 py-2 rounded-lg font-medium hover:bg-opacity-30 transition-all">
                ğŸ“Š åŒ¯å‡ºè³‡æ–™
            </button>
            <button id="shareDataBtn" class="bg-white bg-opacity-20 text-white px-4 py-2 rounded-lg font-medium hover:bg-opacity-30 transition-all">
                ğŸ“¤ åˆ†äº«è³‡æ–™
            </button>
        </div>
    </div>
    
    <!-- æˆåŠŸè¨Šæ¯ -->
    <div id="successMessage" class="success-message">
        <div class="text-2xl mb-2">âœ…</div>
        <div class="text-lg font-bold mb-1">å ±å‘Šæäº¤æˆåŠŸï¼</div>
        <div>æ„Ÿè¬æ‚¨çš„å”åŠ©ï¼Œæˆ‘å€‘æœƒåœ¨24å°æ™‚å…§æ´¾å“¡è™•ç†</div>
    </div>
    
    <!-- åˆ†äº«é€šçŸ¥ -->
    <div id="shareNotification" class="share-notification">
        <div class="flex items-center gap-2">
            <span>âœ…</span>
            <span id="shareNotificationText">åˆ†äº«æˆåŠŸï¼</span>
        </div>
    </div>
    
    <!-- åˆ†äº«å½ˆçª— -->
    <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 max-h-96 overflow-y-auto">
            <div class="text-center mb-4">
                <h3 class="text-xl font-bold text-gray-800 mb-2">ğŸ“¤ åˆ†äº«é€šå ±è³‡æ–™</h3>
                <p class="text-gray-600 text-sm">é¸æ“‡åˆ†äº«æ–¹å¼</p>
            </div>
            
            <div class="space-y-3">
                <button id="shareWhatsApp" class="w-full bg-green-500 text-white p-3 rounded-lg hover:bg-green-600 transition-all flex items-center justify-center gap-2">
                    ğŸ“± WhatsApp åˆ†äº«
                </button>
                <button id="shareLine" class="w-full bg-green-400 text-white p-3 rounded-lg hover:bg-green-500 transition-all flex items-center justify-center gap-2">
                    ğŸ’¬ LINE åˆ†äº«
                </button>
                <button id="shareEmail" class="w-full bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600 transition-all flex items-center justify-center gap-2">
                    ğŸ“§ Email åˆ†äº«
                </button>
                <button id="copyLink" class="w-full bg-gray-500 text-white p-3 rounded-lg hover:bg-gray-600 transition-all flex items-center justify-center gap-2">
                    ğŸ“‹ è¤‡è£½é€£çµ
                </button>
                <button id="shareReport" class="w-full bg-purple-500 text-white p-3 rounded-lg hover:bg-purple-600 transition-all flex items-center justify-center gap-2">
                    ğŸ“Š åˆ†äº«çµ±è¨ˆå ±å‘Š
                </button>
            </div>
            
            <button id="closeShareModal" class="w-full mt-4 bg-gray-200 text-gray-700 p-2 rounded-lg hover:bg-gray-300 transition-all">
                é—œé–‰
            </button>
        </div>
    </div>
    
    <!-- é€šå ±è¨˜éŒ„æŸ¥çœ‹å€åŸŸ -->
    <div id="recordsContainer" class="form-container" style="display: none;">
        <div class="text-center mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-2">é€šå ±è¨˜éŒ„ç®¡ç†</h2>
            <p class="text-gray-600">æŸ¥çœ‹æ‰€æœ‰é€šå ±è¨˜éŒ„ä¸¦é€²è¡Œç®¡ç†</p>
        </div>
        
        <!-- çµ±è¨ˆè³‡è¨Š -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-lg text-center">
                <div class="text-2xl font-bold" id="totalReports">0</div>
                <div class="text-sm">ç¸½é€šå ±æ•¸</div>
            </div>
            <div class="bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-lg text-center">
                <div class="text-2xl font-bold" id="urgentReports">0</div>
                <div class="text-sm">ç·Šæ€¥æ¡ˆä»¶</div>
            </div>
            <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-lg text-center">
                <div class="text-2xl font-bold" id="completedReports">0</div>
                <div class="text-sm">å·²è™•ç†</div>
            </div>
            <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white p-4 rounded-lg text-center">
                <div class="text-2xl font-bold" id="pendingReports">0</div>
                <div class="text-sm">å¾…è™•ç†</div>
            </div>
        </div>
        
        <!-- æœå°‹å’Œç¯©é¸ -->
        <div class="bg-gray-50 p-4 rounded-lg mb-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <input type="text" id="searchInput" placeholder="æœå°‹é€šå ±ç·¨è™Ÿã€åœ°å€æˆ–æè¿°..." class="input-field">
                <select id="filterUrgency" class="select-field">
                    <option value="">æ‰€æœ‰ç·Šæ€¥ç¨‹åº¦</option>
                    <option value="éå¸¸ç·Šæ€¥">éå¸¸ç·Šæ€¥</option>
                    <option value="ç·Šæ€¥">ç·Šæ€¥</option>
                    <option value="ä¸€èˆ¬">ä¸€èˆ¬</option>
                    <option value="ä¸ç·Šæ€¥">ä¸ç·Šæ€¥</option>
                </select>
                <select id="filterStatus" class="select-field">
                    <option value="">æ‰€æœ‰ç‹€æ…‹</option>
                    <option value="å¾…è™•ç†">å¾…è™•ç†</option>
                    <option value="è™•ç†ä¸­">è™•ç†ä¸­</option>
                    <option value="å·²å®Œæˆ">å·²å®Œæˆ</option>
                </select>
            </div>
        </div>
        
        <!-- è¨˜éŒ„åˆ—è¡¨ -->
        <div id="recordsList" class="space-y-4">
            <!-- è¨˜éŒ„é …ç›®å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
        </div>
        
        <!-- æ¸…ç©ºè³‡æ–™æŒ‰éˆ• -->
        <div class="text-center mt-6">
            <button id="clearAllData" class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-all">
                ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰è³‡æ–™
            </button>
        </div>
    </div>

    <!-- è¡¨å–®å®¹å™¨ -->
    <div id="formContainer" class="form-container">
        <div class="text-center mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-2">è«‹å¡«å¯«é€šå ±è³‡è¨Š</h2>
            <p class="text-gray-600">æ‚¨çš„æ¯ä¸€æ¬¡é€šå ±éƒ½æ˜¯å°ç¤¾å€å®‰å…¨çš„é‡è¦è²¢ç»</p>
        </div>
        
        <form id="reportForm" class="space-y-6">
            <!-- åŸºæœ¬è³‡è¨Šå€åŸŸ -->
            <div>
                <h3 class="text-lg font-bold text-gray-700 mb-4 flex items-center">
                    ğŸ‘¤ åŸºæœ¬è³‡è¨Š
                </h3>
                
                <div class="space-y-4">
                    <!-- åŒ¿åé€šå ±é¸é … -->
                    <div>
                        <label class="flex items-center space-x-2 cursor-pointer mb-4">
                            <input type="checkbox" id="anonymousReport" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            <span class="text-sm font-medium text-gray-700">åŒ¿åé€šå ±</span>
                        </label>
                    </div>
                    
                    <!-- å§“å -->
                    <div id="nameSection">
                        <label for="name" class="label required">é€šå ±äººå§“å</label>
                        <select id="name" name="name" required class="select-field">
                            <option value="" disabled selected>è«‹é¸æ“‡æ‚¨çš„å§“å</option>
                            <option value="6611 æœæ–‡çª(ä¸»ä»»)">6611 æœæ–‡çª(ä¸»ä»»)</option>
                            <option value="6613 è•­é›…ç²(ç§˜æ›¸)">6613 è•­é›…ç²(ç§˜æ›¸)</option>
                            <option value="6661 å¼µç¬å¨¥(çµ„é•·)">6661 å¼µç¬å¨¥(çµ„é•·)</option>
                            <option value="6662 å¼µå¸å‡½">6662 å¼µå¸å‡½</option>
                            <option value="6637 å³æ©ç¶º">6637 å³æ©ç¶º</option>
                            <option value="6636 æ¸¸è•™æ…ˆ">6636 æ¸¸è•™æ…ˆ</option>
                            <option value="6659 å¼µé›èŒ¹">6659 å¼µé›èŒ¹</option>
                            <option value="6615 æå‹ç·¯">6615 æå‹ç·¯</option>
                            <option value="6666 è‘‰æ…§ç²">6666 è‘‰æ…§ç²</option>
                            <option value="6667 æ¥Šçµœå®‡">6667 æ¥Šçµœå®‡</option>
                            <option value="6679 å»–å¾—é †">6679 å»–å¾—é †</option>
                            <option value="6668 å½­æ€é§¿">6668 å½­æ€é§¿</option>
                            <option value="6691 é™³å®¶çœŸ">6691 é™³å®¶çœŸ</option>
                            <option value="6653 æ—æ˜æ†²(é˜²ç–«)">6653 æ—æ˜æ†²(é˜²ç–«)</option>
                            <option value="6656 ç‹æ€æ¶µ(é˜²ç–«)">6656 ç‹æ€æ¶µ(é˜²ç–«)</option>
                            <option value="6657 é™³å½¥å®¹(é˜²ç–«)">6657 é™³å½¥å®¹(é˜²ç–«)</option>
                            <option value="6670 ææ™‰å®‰(ä¿è­·æ€§ç¤¾å·¥)">6670 ææ™‰å®‰(ä¿è­·æ€§ç¤¾å·¥)</option>
                            <option value="6671 å¼µç¾å’ª(å°ˆæ¡ˆåŠ©ç†å“¡)">6671 å¼µç¾å’ª(å°ˆæ¡ˆåŠ©ç†å“¡)</option>
                            <option value="6635 ç°¡è© ç¦¾">6635 ç°¡è© ç¦¾</option>
                            <option value="6650 æ±Ÿå©•å¦˜(ä¿è­·æ€§ç¤¾å·¥)">6650 æ±Ÿå©•å¦˜(ä¿è­·æ€§ç¤¾å·¥)</option>
                            <option value="6606 ç¿å‰ç¿”(é—œè¨ªå“¡)">6606 ç¿å‰ç¿”(é—œè¨ªå“¡)</option>
                            <option value="6619 ç‹å“è‰(é—œè¨ªå“¡)">6619 ç‹å“è‰(é—œè¨ªå“¡)</option>
                            <option value="6687 å¾ç¾¤é€¸(é—œè¨ªå“¡)">6687 å¾ç¾¤é€¸(é—œè¨ªå“¡)</option>
                            <option value="6631 æç¿ è“‰(çµ„é•·)">6631 æç¿ è“‰(çµ„é•·)</option>
                            <option value="6632 ç‹æ¢…å¨Ÿ(è­·ç†é•·)">6632 ç‹æ¢…å¨Ÿ(è­·ç†é•·)</option>
                            <option value="6633 ç‹è™¹é›…">6633 ç‹è™¹é›…</option>
                            <option value="6655 æ—é–é›¯">6655 æ—é–é›¯</option>
                            <option value="6665 ç¾…æ¯“å©‰">6665 ç¾…æ¯“å©‰</option>
                            <option value="6638 è‘‰æ™ºå©·">6638 è‘‰æ™ºå©·</option>
                            <option value="6652 æ—æ¹˜ç²">6652 æ—æ¹˜ç²</option>
                            <option value="6658 è¶™ä½©å„€">6658 è¶™ä½©å„€</option>
                            <option value="6651 é™³å®¶ç‘‹">6651 é™³å®¶ç‘‹</option>
                            <option value="6639 è”¡é›…å®‰">6639 è”¡é›…å®‰</option>
                            <option value="åŒ¿åé€šå ±">åŒ¿åé€šå ±</option>
                        </select>
                    </div>
                    
                    <!-- è¯çµ¡é›»è©± -->
                    <div>
                        <label for="phone" class="label">è¯çµ¡é›»è©±</label>
                        <input type="tel" id="phone" name="phone" placeholder="ä¾‹å¦‚: 0912-345-678" class="input-field">
                        <p class="text-xs text-gray-500 mt-1">é¸å¡«ï¼Œæ–¹ä¾¿æˆ‘å€‘è¯ç¹«ç¢ºèªè©³æƒ…</p>
                    </div>
                    
                    <!-- é€šå ±æ—¥æœŸ -->
                    <div>
                        <label for="discoveryDate" class="label required">é€šå ±æ—¥æœŸ</label>
                        <input type="date" id="discoveryDate" name="discoveryDate" required class="input-field">
                    </div>
                </div>
            </div>
            
            <!-- åœ°å€è³‡è¨Šå€åŸŸ -->
            <div class="section-divider">
                <h3 class="text-lg font-bold text-gray-700 mb-4 flex items-center">
                    ğŸ“ é€šå ±åœ°é»
                </h3>
                
                <div class="space-y-4">
                    <!-- é‡Œåˆ¥ -->
                    <div>
                        <label for="village" class="label required">é‡Œåˆ¥</label>
                        <select id="village" name="village" required class="select-field">
                            <option value="" disabled selected>è«‹é¸æ“‡é‡Œåˆ¥</option>
                            <option value="å¤§æœ‰é‡Œ">å¤§æœ‰é‡Œ</option>
                            <option value="å…‰èƒ½é‡Œ">å…‰èƒ½é‡Œ</option>
                            <option value="è€å¸«é‡Œ">è€å¸«é‡Œ</option>
                            <option value="åœ‹æ…¶é‡Œ">åœ‹æ…¶é‡Œ</option>
                            <option value="é„°æ±Ÿé‡Œ">é„°æ±Ÿé‡Œ</option>
                            <option value="æ™¯æ˜Ÿé‡Œ">æ™¯æ˜Ÿé‡Œ</option>
                            <option value="å»ºæ˜é‡Œ">å»ºæ˜é‡Œ</option>
                            <option value="å»ºæ³°é‡Œ">å»ºæ³°é‡Œ</option>
                            <option value="è‡³è–é‡Œ">è‡³è–é‡Œ</option>
                            <option value="é›™é€£é‡Œ">é›™é€£é‡Œ</option>
                            <option value="æ°‘æ¬Šé‡Œ">æ°‘æ¬Šé‡Œ</option>
                            <option value="æ°¸æ¨‚é‡Œ">æ°¸æ¨‚é‡Œ</option>
                            <option value="æœé™½é‡Œ">æœé™½é‡Œ</option>
                            <option value="å—èŠ³é‡Œ">å—èŠ³é‡Œ</option>
                            <option value="æšé›…é‡Œ">æšé›…é‡Œ</option>
                            <option value="æ–¯æ–‡é‡Œ">æ–¯æ–‡é‡Œ</option>
                            <option value="é‡æ…¶é‡Œ">é‡æ…¶é‡Œ</option>
                            <option value="ä¿å®‰é‡Œ">ä¿å®‰é‡Œ</option>
                            <option value="ç‰æ³‰é‡Œ">ç‰æ³‰é‡Œ</option>
                            <option value="è“¬èŠé‡Œ">è“¬èŠé‡Œ</option>
                            <option value="å»ºåŠŸé‡Œ">å»ºåŠŸé‡Œ</option>
                            <option value="å»¶å¹³é‡Œ">å»¶å¹³é‡Œ</option>
                            <option value="æ˜Ÿæ˜é‡Œ">æ˜Ÿæ˜é‡Œ</option>
                            <option value="éš†å’Œé‡Œ">éš†å’Œé‡Œ</option>
                            <option value="åœ‹é †é‡Œ">åœ‹é †é‡Œ</option>
                        </select>
                    </div>
                    
                    <!-- è·¯å -->
                    <div>
                        <label for="road" class="label required">è·¯ååœ°å€</label>
                        <select id="road" name="road" required class="select-field">
                            <option value="" disabled selected>è«‹é¸æ“‡è·¯å</option>
                            <option value="äº”åŸè·¯">äº”åŸè·¯</option>
                            <option value="ä¼Šå¯§è¡—">ä¼Šå¯§è¡—</option>
                            <option value="ä¿å®‰è¡—">ä¿å®‰è¡—</option>
                            <option value="å—äº¬è¥¿è·¯">å—äº¬è¥¿è·¯</option>
                            <option value="å“ˆå¯†è¡—">å“ˆå¯†è¡—</option>
                            <option value="å¡”åŸè¡—">å¡”åŸè¡—</option>
                            <option value="å¤§é¾è¡—">å¤§é¾è¡—</option>
                            <option value="å¤©æ°´è·¯">å¤©æ°´è·¯</option>
                            <option value="å¤ªåŸè·¯">å¤ªåŸè·¯</option>
                            <option value="å®‰è¥¿è¡—">å®‰è¥¿è¡—</option>
                            <option value="å¯§å¤è·¯">å¯§å¤è·¯</option>
                            <option value="å¸‚æ°‘å¤§é“ï¼‘æ®µ">å¸‚æ°‘å¤§é“ï¼‘æ®µ</option>
                            <option value="å¹³é™½è¡—">å¹³é™½è¡—</option>
                            <option value="åº«å€«è¡—">åº«å€«è¡—</option>
                            <option value="å»¶å¹³åŒ—è·¯ï¼‘æ®µ">å»¶å¹³åŒ—è·¯ï¼‘æ®µ</option>
                            <option value="å»¶å¹³åŒ—è·¯ï¼’æ®µ">å»¶å¹³åŒ—è·¯ï¼’æ®µ</option>
                            <option value="å»¶å¹³åŒ—è·¯ï¼“æ®µ">å»¶å¹³åŒ—è·¯ï¼“æ®µ</option>
                            <option value="å»¶å¹³åŒ—è·¯ï¼”æ®µ">å»¶å¹³åŒ—è·¯ï¼”æ®µ</option>
                            <option value="å¿ å­è¥¿è·¯ï¼’æ®µ">å¿ å­è¥¿è·¯ï¼’æ®µ</option>
                            <option value="æ‰¿å¾·è·¯ï¼‘æ®µ">æ‰¿å¾·è·¯ï¼‘æ®µ</option>
                            <option value="æ‰¿å¾·è·¯ï¼’æ®µ">æ‰¿å¾·è·¯ï¼’æ®µ</option>
                            <option value="æ‰¿å¾·è·¯ï¼“æ®µ">æ‰¿å¾·è·¯ï¼“æ®µ</option>
                            <option value="æ’«é †è¡—">æ’«é †è¡—</option>
                            <option value="æ•¦ç…Œè·¯">æ•¦ç…Œè·¯</option>
                            <option value="æ˜Œå‰è¡—">æ˜Œå‰è¡—</option>
                            <option value="æ™¯åŒ–è¡—">æ™¯åŒ–è¡—</option>
                            <option value="æ­¸ç¶è¡—">æ­¸ç¶è¡—</option>
                            <option value="æ°‘æ—è¥¿è·¯">æ°‘æ—è¥¿è·¯</option>
                            <option value="æ°‘æ¨‚è¡—">æ°‘æ¨‚è¡—</option>
                            <option value="æ°‘æ¬Šè¥¿è·¯">æ°‘æ¬Šè¥¿è·¯</option>
                            <option value="æ°‘ç”Ÿè¥¿è·¯">æ°‘ç”Ÿè¥¿è·¯</option>
                            <option value="æ°¸æ˜Œè¡—">æ°¸æ˜Œè¡—</option>
                            <option value="æ¶¼å·è¡—">æ¶¼å·è¡—</option>
                            <option value="ç’°æ²³åŒ—è·¯ï¼‘æ®µ">ç’°æ²³åŒ—è·¯ï¼‘æ®µ</option>
                            <option value="ç’°æ²³åŒ—è·¯ï¼’æ®µ">ç’°æ²³åŒ—è·¯ï¼’æ®µ</option>
                            <option value="ç”˜å·è¡—">ç”˜å·è¡—</option>
                            <option value="ç”˜è°·è¡—">ç”˜è°·è¡—</option>
                            <option value="èˆˆåŸè¡—">èˆˆåŸè¡—</option>
                            <option value="è¯äº­è¡—">è¯äº­è¡—</option>
                            <option value="è¯é™°è¡—">è¯é™°è¡—</option>
                            <option value="è¬å…¨è¡—">è¬å…¨è¡—</option>
                            <option value="è˜­å·è¡—">è˜­å·è¡—</option>
                            <option value="è¥¿å¯§åŒ—è·¯">è¥¿å¯§åŒ—è·¯</option>
                            <option value="è²´å¾·è¡—">è²´å¾·è¡—</option>
                            <option value="èµ¤å³°è¡—">èµ¤å³°è¡—</option>
                            <option value="è¿ªåŒ–è¡—ï¼‘æ®µ">è¿ªåŒ–è¡—ï¼‘æ®µ</option>
                            <option value="è¿ªåŒ–è¡—ï¼’æ®µ">è¿ªåŒ–è¡—ï¼’æ®µ</option>
                            <option value="é€šæ²³è¥¿è¡—ï¼‘æ®µ">é€šæ²³è¥¿è¡—ï¼‘æ®µ</option>
                            <option value="é„­å·è·¯">é„­å·è·¯</option>
                            <option value="é…’æ³‰è¡—">é…’æ³‰è¡—</option>
                            <option value="é‡æ…¶åŒ—è·¯ï¼‘æ®µ">é‡æ…¶åŒ—è·¯ï¼‘æ®µ</option>
                            <option value="é‡æ…¶åŒ—è·¯ï¼’æ®µ">é‡æ…¶åŒ—è·¯ï¼’æ®µ</option>
                            <option value="é‡æ…¶åŒ—è·¯ï¼“æ®µ">é‡æ…¶åŒ—è·¯ï¼“æ®µ</option>
                            <option value="éŒ¦è¥¿è¡—">éŒ¦è¥¿è¡—</option>
                            <option value="é•·å®‰è¥¿è·¯">é•·å®‰è¥¿è·¯</option>
                            <option value="é›™é€£è¡—">é›™é€£è¡—</option>
                        </select>
                    </div>
                    
                    <!-- è©³ç´°åœ°å€ -->
                    <div class="grid-responsive">
                        <div>
                            <label for="lane" class="label">å··</label>
                            <input type="text" id="lane" name="lane" placeholder="123" class="input-field">
                        </div>
                        <div>
                            <label for="alley" class="label">å¼„</label>
                            <input type="text" id="alley" name="alley" placeholder="45" class="input-field">
                        </div>
                        <div>
                            <label for="number" class="label required">è™Ÿ</label>
                            <input type="text" id="number" name="number" required placeholder="67" class="input-field">
                        </div>
                        <div>
                            <label for="subnumber" class="label">ä¹‹</label>
                            <input type="text" id="subnumber" name="subnumber" placeholder="1" class="input-field">
                        </div>
                        <div>
                            <label for="floor" class="label">æ¨“</label>
                            <input type="text" id="floor" name="floor" placeholder="2" class="input-field">
                        </div>
                    </div>
                    
                    <!-- åœ°æ¨™æè¿° -->
                    <div>
                        <label for="landmark" class="label">é™„è¿‘åœ°æ¨™</label>
                        <input type="text" id="landmark" name="landmark" placeholder="ä¾‹å¦‚: 7-11ä¾¿åˆ©å•†åº—æ—ã€å…¬è»Šç«™ç‰Œå‰" class="input-field">
                        <p class="text-xs text-gray-500 mt-1">å¹«åŠ©æˆ‘å€‘æ›´å¿«æ‰¾åˆ°ç¢ºåˆ‡ä½ç½®</p>
                    </div>
                </div>
            </div>
            
            <!-- å±éšªè³‡è¨Šå€åŸŸ -->
            <div class="section-divider">
                <h3 class="text-lg font-bold text-gray-700 mb-4 flex items-center">
                    âš ï¸ å±éšªè³‡è¨Š
                </h3>
                
                <div class="space-y-4">
                    <!-- é«˜å±é»é¡å‹ -->
                    <div>
                        <label for="riskType" class="label required">é«˜å±é»é¡å‹</label>
                        <select id="riskType" name="riskType" required class="select-field">
                            <option value="" disabled selected>è«‹é¸æ“‡é«˜å±é»é¡å‹</option>
                            <option value="ä½å®…">ğŸ  ä½å®…</option>
                            <option value="æ©Ÿé—œ">ğŸ›ï¸ æ©Ÿé—œ</option>
                            <option value="å­¸æ ¡">ğŸ« å­¸æ ¡</option>
                            <option value="ç©ºåœ°">ğŸï¸ ç©ºåœ°</option>
                            <option value="å…¬åœ’">ğŸŒ³ å…¬åœ’</option>
                            <option value="èœåœ’">ğŸ¥¬ èœåœ’</option>
                            <option value="å¸‚å ´">ğŸª å¸‚å ´</option>
                            <option value="ç©ºå±‹">ğŸšï¸ ç©ºå±‹</option>
                            <option value="å…¶ä»–">â“ å…¶ä»–</option>
                        </select>
                    </div>
                    
                    <!-- ç·Šæ€¥ç¨‹åº¦ -->
                    <div>
                        <label for="urgency" class="label required">ç·Šæ€¥ç¨‹åº¦</label>
                        <select id="urgency" name="urgency" required class="select-field">
                            <option value="" disabled selected>è«‹è©•ä¼°å±éšªç¨‹åº¦</option>
                            <option value="éå¸¸ç·Šæ€¥">ğŸ”´ éå¸¸ç·Šæ€¥ - æœ‰ç«‹å³å±éšªï¼Œéœ€é¦¬ä¸Šè™•ç†</option>
                            <option value="ç·Šæ€¥">ğŸŸ  ç·Šæ€¥ - 24å°æ™‚å…§éœ€è¦è™•ç†</option>
                            <option value="ä¸€èˆ¬">ğŸŸ¡ ä¸€èˆ¬ - ä¸€é€±å…§è™•ç†å³å¯</option>
                            <option value="ä¸ç·Šæ€¥">ğŸŸ¢ ä¸ç·Šæ€¥ - ä¸€å€‹æœˆå…§è™•ç†</option>
                        </select>
                    </div>
                    
                    <!-- è©³ç´°æè¿° -->
                    <div>
                        <label for="description" class="label required">è©³ç´°æè¿°</label>
                        <textarea id="description" name="description" required 
                                  placeholder="è«‹è©³ç´°æè¿°ï¼š&#10;1. å…·é«”å±éšªæƒ…æ³&#10;2. å½±éŸ¿ç¯„åœå¤§å°&#10;3. æ˜¯å¦æœ‰äººå—å‚·&#10;4. å…¶ä»–é‡è¦è³‡è¨Š" 
                                  rows="5" class="textarea-field resize-none"></textarea>
                    </div>
                    
                    <!-- ä¸Šå‚³ç…§ç‰‡ -->
                    <div>
                        <label for="photos" class="label">ä¸Šå‚³ç…§ç‰‡</label>
                        <input type="file" id="photos" name="photos" accept="image/*" multiple class="input-field">
                        <p class="text-xs text-gray-500 mt-1">å¯ä¸Šå‚³å¤šå¼µç…§ç‰‡ï¼Œæœ‰åŠ©æ–¼æˆ‘å€‘æ›´å¿«äº†è§£ç¾å ´ç‹€æ³</p>
                        <div id="photoPreview" class="mt-2 grid grid-cols-2 md:grid-cols-3 gap-2"></div>
                    </div>
                </div>
            </div>
            
            <!-- æäº¤æŒ‰éˆ• -->
            <div class="pt-6">
                <button type="submit" class="submit-btn">
                    ğŸ“¤ ç«‹å³æäº¤é€šå ±
                </button>
                <p class="text-xs text-gray-500 text-center mt-3">
                    æäº¤å¾Œæˆ‘å€‘æœƒç«‹å³è™•ç†ï¼Œæ„Ÿè¬æ‚¨å°ç¤¾å€å®‰å…¨çš„é—œå¿ƒ
                </p>
            </div>
        </form>
    </div>
</div>

<script>
    // æ—¥æœŸé¸æ“‡å™¨åŠŸèƒ½
    const discoveryDate = document.getElementById('discoveryDate');
    
    // è¨­å®šä»Šå¤©ç‚ºé è¨­æ—¥æœŸ
    const today = new Date();
    discoveryDate.value = today.toISOString().split('T')[0];
    
    // åŒ¿åé€šå ±åŠŸèƒ½
    const anonymousCheckbox = document.getElementById('anonymousReport');
    const nameSection = document.getElementById('nameSection');
    const nameSelect = document.getElementById('name');
    
    anonymousCheckbox.addEventListener('change', function() {
        if (this.checked) {
            nameSection.style.display = 'none';
            nameSelect.removeAttribute('required');
            nameSelect.value = 'åŒ¿åé€šå ±';
        } else {
            nameSection.style.display = 'block';
            nameSelect.setAttribute('required', '');
            nameSelect.value = '';
        }
    });
    
    // ç·Šæ€¥ç¨‹åº¦è¦–è¦ºæç¤º
    document.getElementById('urgency').addEventListener('change', function() {
        const container = this.closest('.section-divider');
        container.classList.remove('urgency-high', 'urgency-medium', 'urgency-low');
        
        if (this.value === 'éå¸¸ç·Šæ€¥') {
            container.classList.add('urgency-high');
        } else if (this.value === 'ç·Šæ€¥') {
            container.classList.add('urgency-medium');
        } else if (this.value === 'ä¸€èˆ¬' || this.value === 'ä¸ç·Šæ€¥') {
            container.classList.add('urgency-low');
        }
    });
    
    // ç…§ç‰‡ä¸Šå‚³é è¦½åŠŸèƒ½
    const photoInput = document.getElementById('photos');
    const photoPreview = document.getElementById('photoPreview');
    
    photoInput.addEventListener('change', function(e) {
        photoPreview.innerHTML = '';
        const files = Array.from(e.target.files);
        
        files.forEach((file, index) => {
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const div = document.createElement('div');
                    div.className = 'relative';
                    div.innerHTML = `
                        <img src="${e.target.result}" alt="é è¦½åœ–ç‰‡ ${index + 1}" 
                             class="w-full h-24 object-cover rounded-lg border-2 border-gray-200">
                        <button type="button" onclick="removePhoto(${index})" 
                                class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 text-xs hover:bg-red-600">
                            Ã—
                        </button>
                    `;
                    photoPreview.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
        });
    });
    
    // ç§»é™¤ç…§ç‰‡åŠŸèƒ½
    window.removePhoto = function(index) {
        const dt = new DataTransfer();
        const files = Array.from(photoInput.files);
        
        files.forEach((file, i) => {
            if (i !== index) {
                dt.items.add(file);
            }
        });
        
        photoInput.files = dt.files;
        photoInput.dispatchEvent(new Event('change'));
    };
    
    // æœ¬åœ°å„²å­˜åŠŸèƒ½
    function saveReportToStorage(reportData) {
        let reports = JSON.parse(localStorage.getItem('hazardReports') || '[]');
        reports.push(reportData);
        localStorage.setItem('hazardReports', JSON.stringify(reports));
    }
    
    function getReportsFromStorage() {
        return JSON.parse(localStorage.getItem('hazardReports') || '[]');
    }
    
    function updateReportStatus(reportId, newStatus) {
        let reports = getReportsFromStorage();
        const reportIndex = reports.findIndex(r => r.reportId === reportId);
        if (reportIndex !== -1) {
            reports[reportIndex].status = newStatus;
            localStorage.setItem('hazardReports', JSON.stringify(reports));
            displayReports();
            updateStatistics();
        }
    }
    
    function deleteReport(reportId) {
        if (confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†é€šå ±è¨˜éŒ„å—ï¼Ÿ')) {
            let reports = getReportsFromStorage();
            reports = reports.filter(r => r.reportId !== reportId);
            localStorage.setItem('hazardReports', JSON.stringify(reports));
            displayReports();
            updateStatistics();
        }
    }
    
    // é é¢åˆ‡æ›åŠŸèƒ½
    const showFormBtn = document.getElementById('showFormBtn');
    const showRecordsBtn = document.getElementById('showRecordsBtn');
    const exportDataBtn = document.getElementById('exportDataBtn');
    const shareDataBtn = document.getElementById('shareDataBtn');
    const formContainer = document.getElementById('formContainer');
    const recordsContainer = document.getElementById('recordsContainer');
    
    showFormBtn.addEventListener('click', function() {
        formContainer.style.display = 'block';
        recordsContainer.style.display = 'none';
        this.classList.add('bg-opacity-40');
        showRecordsBtn.classList.remove('bg-opacity-40');
    });
    
    showRecordsBtn.addEventListener('click', function() {
        formContainer.style.display = 'none';
        recordsContainer.style.display = 'block';
        this.classList.add('bg-opacity-40');
        showFormBtn.classList.remove('bg-opacity-40');
        displayReports();
        updateStatistics();
    });
    
    // åˆ†äº«åŠŸèƒ½
    const shareModal = document.getElementById('shareModal');
    const shareNotification = document.getElementById('shareNotification');
    const shareNotificationText = document.getElementById('shareNotificationText');
    
    shareDataBtn.addEventListener('click', function() {
        const reports = getReportsFromStorage();
        if (reports.length === 0) {
            alert('æ²’æœ‰è³‡æ–™å¯ä»¥åˆ†äº«ï¼è«‹å…ˆæ–°å¢é€šå ±è¨˜éŒ„ã€‚');
            return;
        }
        shareModal.style.display = 'flex';
    });
    
    document.getElementById('closeShareModal').addEventListener('click', function() {
        shareModal.style.display = 'none';
    });
    
    // åˆ†äº«é€šçŸ¥åŠŸèƒ½
    function showShareNotification(message) {
        shareNotificationText.textContent = message;
        shareNotification.classList.add('show');
        setTimeout(() => {
            shareNotification.classList.remove('show');
        }, 3000);
    }
    
    // WhatsApp åˆ†äº«
    document.getElementById('shareWhatsApp').addEventListener('click', function() {
        const reports = getReportsFromStorage();
        const summary = generateShareSummary(reports);
        const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(summary)}`;
        window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
        shareModal.style.display = 'none';
        showShareNotification('å·²é–‹å•Ÿ WhatsApp åˆ†äº«ï¼');
    });
    
    // LINE åˆ†äº«
    document.getElementById('shareLine').addEventListener('click', function() {
        const reports = getReportsFromStorage();
        const summary = generateShareSummary(reports);
        const lineUrl = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(summary)}`;
        window.open(lineUrl, '_blank', 'noopener,noreferrer');
        shareModal.style.display = 'none';
        showShareNotification('å·²é–‹å•Ÿ LINE åˆ†äº«ï¼');
    });
    
    // Email åˆ†äº«
    document.getElementById('shareEmail').addEventListener('click', function() {
        const reports = getReportsFromStorage();
        const summary = generateShareSummary(reports);
        const subject = 'é«˜å±é»é€šå ±è³‡æ–™åˆ†äº«';
        const emailUrl = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(summary)}`;
        window.open(emailUrl, '_blank', 'noopener,noreferrer');
        shareModal.style.display = 'none';
        showShareNotification('å·²é–‹å•Ÿ Email åˆ†äº«ï¼');
    });
    
    // è¤‡è£½é€£çµ
    document.getElementById('copyLink').addEventListener('click', function() {
        const reports = getReportsFromStorage();
        const summary = generateShareSummary(reports);
        
        if (navigator.clipboard) {
            navigator.clipboard.writeText(summary).then(() => {
                shareModal.style.display = 'none';
                showShareNotification('è³‡æ–™å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
            }).catch(() => {
                fallbackCopyText(summary);
            });
        } else {
            fallbackCopyText(summary);
        }
    });
    
    // å‚™ç”¨è¤‡è£½åŠŸèƒ½
    function fallbackCopyText(text) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        try {
            document.execCommand('copy');
            shareModal.style.display = 'none';
            showShareNotification('è³‡æ–™å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
        } catch (err) {
            alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½è³‡æ–™');
        }
        document.body.removeChild(textArea);
    }
    
    // åˆ†äº«çµ±è¨ˆå ±å‘Š
    document.getElementById('shareReport').addEventListener('click', function() {
        const reports = getReportsFromStorage();
        const reportSummary = generateDetailedReport(reports);
        
        if (navigator.clipboard) {
            navigator.clipboard.writeText(reportSummary).then(() => {
                shareModal.style.display = 'none';
                showShareNotification('çµ±è¨ˆå ±å‘Šå·²è¤‡è£½ï¼');
            }).catch(() => {
                fallbackCopyText(reportSummary);
            });
        } else {
            fallbackCopyText(reportSummary);
        }
    });
    
    // ç”Ÿæˆåˆ†äº«æ‘˜è¦
    function generateShareSummary(reports) {
        const totalReports = reports.length;
        const urgentReports = reports.filter(r => r.urgency === 'éå¸¸ç·Šæ€¥' || r.urgency === 'ç·Šæ€¥').length;
        const completedReports = reports.filter(r => r.status === 'å·²å®Œæˆ').length;
        const pendingReports = reports.filter(r => r.status === 'å¾…è™•ç†').length;
        
        let summary = `ğŸš¨ é«˜å±é»å ±é¦¬ä»” - é€šå ±è³‡æ–™æ‘˜è¦\n`;
        summary += `ğŸ“Š çµ±è¨ˆè³‡è¨Šï¼š\n`;
        summary += `â€¢ ç¸½é€šå ±æ•¸ï¼š${totalReports} ç­†\n`;
        summary += `â€¢ ç·Šæ€¥æ¡ˆä»¶ï¼š${urgentReports} ç­†\n`;
        summary += `â€¢ å·²è™•ç†ï¼š${completedReports} ç­†\n`;
        summary += `â€¢ å¾…è™•ç†ï¼š${pendingReports} ç­†\n\n`;
        
        if (reports.length > 0) {
            summary += `ğŸ“‹ æœ€æ–°é€šå ±è¨˜éŒ„ï¼š\n`;
            const latestReports = reports.slice(-3).reverse();
            latestReports.forEach((report, index) => {
                summary += `${index + 1}. ${report.reportId}\n`;
                summary += `   åœ°å€ï¼š${report.fullAddress}\n`;
                summary += `   é¡å‹ï¼š${report.riskType} | ç·Šæ€¥ç¨‹åº¦ï¼š${report.urgency}\n`;
                summary += `   ç‹€æ…‹ï¼š${report.status}\n\n`;
            });
        }
        
        summary += `â° è³‡æ–™æ›´æ–°æ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}\n`;
        summary += `ğŸ”— ç³»çµ±ï¼šé«˜å±é»å ±é¦¬ä»”æ™ºæ…§é€šå ±ç³»çµ±`;
        
        return summary;
    }
    
    // ç”Ÿæˆè©³ç´°å ±å‘Š
    function generateDetailedReport(reports) {
        let report = `ğŸ“Š é«˜å±é»é€šå ±ç³»çµ± - è©³ç´°çµ±è¨ˆå ±å‘Š\n`;
        report += `${'='.repeat(40)}\n\n`;
        
        // åŸºæœ¬çµ±è¨ˆ
        const totalReports = reports.length;
        const urgentReports = reports.filter(r => r.urgency === 'éå¸¸ç·Šæ€¥' || r.urgency === 'ç·Šæ€¥').length;
        const completedReports = reports.filter(r => r.status === 'å·²å®Œæˆ').length;
        const pendingReports = reports.filter(r => r.status === 'å¾…è™•ç†').length;
        const processingReports = reports.filter(r => r.status === 'è™•ç†ä¸­').length;
        
        report += `ğŸ“ˆ åŸºæœ¬çµ±è¨ˆï¼š\n`;
        report += `â€¢ ç¸½é€šå ±æ•¸ï¼š${totalReports} ç­†\n`;
        report += `â€¢ ç·Šæ€¥æ¡ˆä»¶ï¼š${urgentReports} ç­† (${totalReports > 0 ? Math.round(urgentReports/totalReports*100) : 0}%)\n`;
        report += `â€¢ å·²å®Œæˆï¼š${completedReports} ç­† (${totalReports > 0 ? Math.round(completedReports/totalReports*100) : 0}%)\n`;
        report += `â€¢ è™•ç†ä¸­ï¼š${processingReports} ç­† (${totalReports > 0 ? Math.round(processingReports/totalReports*100) : 0}%)\n`;
        report += `â€¢ å¾…è™•ç†ï¼š${pendingReports} ç­† (${totalReports > 0 ? Math.round(pendingReports/totalReports*100) : 0}%)\n\n`;
        
        // ç·Šæ€¥ç¨‹åº¦åˆ†æ
        const urgencyStats = {};
        reports.forEach(r => {
            urgencyStats[r.urgency] = (urgencyStats[r.urgency] || 0) + 1;
        });
        
        report += `âš ï¸ ç·Šæ€¥ç¨‹åº¦åˆ†æï¼š\n`;
        Object.entries(urgencyStats).forEach(([urgency, count]) => {
            report += `â€¢ ${urgency}ï¼š${count} ç­†\n`;
        });
        report += `\n`;
        
        // é«˜å±é»é¡å‹åˆ†æ
        const typeStats = {};
        reports.forEach(r => {
            typeStats[r.riskType] = (typeStats[r.riskType] || 0) + 1;
        });
        
        report += `ğŸ  é«˜å±é»é¡å‹åˆ†æï¼š\n`;
        Object.entries(typeStats).forEach(([type, count]) => {
            report += `â€¢ ${type}ï¼š${count} ç­†\n`;
        });
        report += `\n`;
        
        // é‡Œåˆ¥åˆ†æ
        const villageStats = {};
        reports.forEach(r => {
            villageStats[r.village] = (villageStats[r.village] || 0) + 1;
        });
        
        report += `ğŸ“ é‡Œåˆ¥åˆ†æï¼š\n`;
        Object.entries(villageStats)
            .sort(([,a], [,b]) => b - a)
            .slice(0, 10)
            .forEach(([village, count]) => {
                report += `â€¢ ${village}ï¼š${count} ç­†\n`;
            });
        
        report += `\nâ° å ±å‘Šç”Ÿæˆæ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}\n`;
        report += `ğŸ”— ç³»çµ±ï¼šé«˜å±é»å ±é¦¬ä»”æ™ºæ…§é€šå ±ç³»çµ±`;
        
        return report;
    }
    
    // é¡¯ç¤ºé€šå ±è¨˜éŒ„
    function displayReports(filteredReports = null) {
        const reports = filteredReports || getReportsFromStorage();
        const recordsList = document.getElementById('recordsList');
        
        if (reports.length === 0) {
            recordsList.innerHTML = `
                <div class="text-center py-8 text-gray-500">
                    <div class="text-4xl mb-4">ğŸ“</div>
                    <div class="text-lg">å°šç„¡é€šå ±è¨˜éŒ„</div>
                    <div class="text-sm">è«‹å…ˆæ–°å¢é€šå ±è³‡æ–™</div>
                </div>
            `;
            return;
        }
        
        recordsList.innerHTML = reports.map(report => {
            const urgencyColor = {
                'éå¸¸ç·Šæ€¥': 'bg-red-100 border-red-500 text-red-800',
                'ç·Šæ€¥': 'bg-orange-100 border-orange-500 text-orange-800',
                'ä¸€èˆ¬': 'bg-yellow-100 border-yellow-500 text-yellow-800',
                'ä¸ç·Šæ€¥': 'bg-green-100 border-green-500 text-green-800'
            };
            
            const statusColor = {
                'å¾…è™•ç†': 'bg-gray-100 text-gray-800',
                'è™•ç†ä¸­': 'bg-blue-100 text-blue-800',
                'å·²å®Œæˆ': 'bg-green-100 text-green-800'
            };
            
            return `
                <div class="bg-white border-2 border-gray-200 rounded-lg p-4 hover:shadow-lg transition-all">
                    <div class="flex flex-wrap justify-between items-start mb-3">
                        <div>
                            <h3 class="font-bold text-lg text-gray-800">${report.reportId}</h3>
                            <p class="text-sm text-gray-600">${new Date(report.timestamp).toLocaleString('zh-TW')}</p>
                        </div>
                        <div class="flex gap-2">
                            <span class="px-3 py-1 rounded-full text-xs font-medium ${urgencyColor[report.urgency] || 'bg-gray-100 text-gray-800'}">
                                ${report.urgency}
                            </span>
                            <span class="px-3 py-1 rounded-full text-xs font-medium ${statusColor[report.status] || 'bg-gray-100 text-gray-800'}">
                                ${report.status}
                            </span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <p class="text-sm font-medium text-gray-700">é€šå ±äººï¼š${report.name || 'åŒ¿å'}</p>
                            <p class="text-sm font-medium text-gray-700">é‡Œåˆ¥ï¼š${report.village}</p>
                            <p class="text-sm font-medium text-gray-700">åœ°å€ï¼š${report.fullAddress}</p>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-700">é¡å‹ï¼š${report.riskType}</p>
                            <p class="text-sm font-medium text-gray-700">é›»è©±ï¼š${report.phone || 'æœªæä¾›'}</p>
                            <p class="text-sm font-medium text-gray-700">åœ°æ¨™ï¼š${report.landmark || 'ç„¡'}</p>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <p class="text-sm font-medium text-gray-700 mb-1">è©³ç´°æè¿°ï¼š</p>
                        <p class="text-sm text-gray-600 bg-gray-50 p-2 rounded">${report.description}</p>
                    </div>
                    
                    <div class="flex flex-wrap gap-2">
                        <select onchange="updateReportStatus('${report.reportId}', this.value)" class="text-xs px-2 py-1 border rounded">
                            <option value="å¾…è™•ç†" ${report.status === 'å¾…è™•ç†' ? 'selected' : ''}>å¾…è™•ç†</option>
                            <option value="è™•ç†ä¸­" ${report.status === 'è™•ç†ä¸­' ? 'selected' : ''}>è™•ç†ä¸­</option>
                            <option value="å·²å®Œæˆ" ${report.status === 'å·²å®Œæˆ' ? 'selected' : ''}>å·²å®Œæˆ</option>
                        </select>
                        <button onclick="deleteReport('${report.reportId}')" class="text-xs bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">
                            åˆªé™¤
                        </button>
                    </div>
                </div>
            `;
        }).join('');
    }
    
    // æ›´æ–°çµ±è¨ˆè³‡è¨Š
    function updateStatistics() {
        const reports = getReportsFromStorage();
        document.getElementById('totalReports').textContent = reports.length;
        document.getElementById('urgentReports').textContent = reports.filter(r => r.urgency === 'éå¸¸ç·Šæ€¥' || r.urgency === 'ç·Šæ€¥').length;
        document.getElementById('completedReports').textContent = reports.filter(r => r.status === 'å·²å®Œæˆ').length;
        document.getElementById('pendingReports').textContent = reports.filter(r => r.status === 'å¾…è™•ç†').length;
    }
    
    // æœå°‹å’Œç¯©é¸åŠŸèƒ½
    document.getElementById('searchInput').addEventListener('input', filterReports);
    document.getElementById('filterUrgency').addEventListener('change', filterReports);
    document.getElementById('filterStatus').addEventListener('change', filterReports);
    
    function filterReports() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const urgencyFilter = document.getElementById('filterUrgency').value;
        const statusFilter = document.getElementById('filterStatus').value;
        
        let reports = getReportsFromStorage();
        
        if (searchTerm) {
            reports = reports.filter(report => 
                report.reportId.toLowerCase().includes(searchTerm) ||
                report.fullAddress.toLowerCase().includes(searchTerm) ||
                report.description.toLowerCase().includes(searchTerm) ||
                (report.name && report.name.toLowerCase().includes(searchTerm))
            );
        }
        
        if (urgencyFilter) {
            reports = reports.filter(report => report.urgency === urgencyFilter);
        }
        
        if (statusFilter) {
            reports = reports.filter(report => report.status === statusFilter);
        }
        
        displayReports(reports);
    }
    
    // CSV åŒ¯å‡ºåŠŸèƒ½
    exportDataBtn.addEventListener('click', function() {
        const reports = getReportsFromStorage();
        if (reports.length === 0) {
            alert('æ²’æœ‰è³‡æ–™å¯ä»¥åŒ¯å‡ºï¼');
            return;
        }
        
        const csvContent = generateCSV(reports);
        downloadCSV(csvContent, `é€šå ±è¨˜éŒ„_${new Date().toISOString().split('T')[0]}.csv`);
    });
    
    function generateCSV(reports) {
        const headers = [
            'é€šå ±ç·¨è™Ÿ', 'é€šå ±æ™‚é–“', 'é€šå ±äºº', 'è¯çµ¡é›»è©±', 'é‡Œåˆ¥', 'å®Œæ•´åœ°å€', 
            'é«˜å±é»é¡å‹', 'ç·Šæ€¥ç¨‹åº¦', 'è©³ç´°æè¿°', 'é™„è¿‘åœ°æ¨™', 'è™•ç†ç‹€æ…‹'
        ];
        
        const csvRows = [headers.join(',')];
        
        reports.forEach(report => {
            const row = [
                report.reportId,
                new Date(report.timestamp).toLocaleString('zh-TW'),
                report.name || 'åŒ¿å',
                report.phone || '',
                report.village,
                report.fullAddress,
                report.riskType,
                report.urgency,
                `"${report.description.replace(/"/g, '""')}"`,
                report.landmark || '',
                report.status
            ];
            csvRows.push(row.join(','));
        });
        
        return csvRows.join('\n');
    }
    
    function downloadCSV(csvContent, filename) {
        try {
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            
            // æª¢æŸ¥ç€è¦½å™¨æ”¯æ´
            if (window.navigator && window.navigator.msSaveOrOpenBlob) {
                // IE æ”¯æ´
                window.navigator.msSaveOrOpenBlob(blob, filename);
            } else {
                // ç¾ä»£ç€è¦½å™¨
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                link.style.display = 'none';
                
                document.body.appendChild(link);
                link.click();
                
                // æ¸…ç†
                setTimeout(() => {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 100);
            }
            
            // é¡¯ç¤ºæˆåŠŸé€šçŸ¥
            showShareNotification('CSV æª”æ¡ˆä¸‹è¼‰æˆåŠŸï¼');
            
        } catch (error) {
            console.error('ä¸‹è¼‰å¤±æ•—:', error);
            
            // å‚™ç”¨æ–¹æ¡ˆï¼šè¤‡è£½åˆ°å‰ªè²¼ç°¿
            if (navigator.clipboard) {
                navigator.clipboard.writeText(csvContent).then(() => {
                    alert('ä¸‹è¼‰å¤±æ•—ï¼Œä½†è³‡æ–™å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼\næ‚¨å¯ä»¥è²¼åˆ° Excel æˆ–è¨˜äº‹æœ¬ä¸­å„²å­˜ã€‚');
                }).catch(() => {
                    fallbackShowData(csvContent);
                });
            } else {
                fallbackShowData(csvContent);
            }
        }
    }
    
    // å‚™ç”¨é¡¯ç¤ºè³‡æ–™æ–¹æ¡ˆ
    function fallbackShowData(csvContent) {
        const newWindow = window.open('', '_blank');
        if (newWindow) {
            newWindow.document.write(`
                <html>
                <head><title>é€šå ±è³‡æ–™</title></head>
                <body>
                    <h2>é€šå ±è³‡æ–™ CSV æ ¼å¼</h2>
                    <p>è«‹è¤‡è£½ä»¥ä¸‹å…§å®¹åˆ° Excel æˆ–è¨˜äº‹æœ¬ä¸­å„²å­˜ï¼š</p>
                    <textarea style="width:100%;height:400px;font-family:monospace;">${csvContent}</textarea>
                    <br><br>
                    <button onclick="navigator.clipboard.writeText(document.querySelector('textarea').value).then(() => alert('å·²è¤‡è£½ï¼'))">è¤‡è£½å…¨éƒ¨</button>
                </body>
                </html>
            `);
        } else {
            alert('ç„¡æ³•é–‹å•Ÿæ–°è¦–çª—ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨è¨­å®šæˆ–æ‰‹å‹•è¤‡è£½è³‡æ–™ã€‚');
        }
    }
    
    // æ¸…ç©ºæ‰€æœ‰è³‡æ–™
    document.getElementById('clearAllData').addEventListener('click', function() {
        if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰é€šå ±è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
            localStorage.removeItem('hazardReports');
            displayReports();
            updateStatistics();
            alert('æ‰€æœ‰è³‡æ–™å·²æ¸…ç©ºï¼');
        }
    });
    
    // å°‡å‡½æ•¸è¨­ç‚ºå…¨åŸŸï¼Œä¾› HTML ä¸­çš„ onclick ä½¿ç”¨
    window.updateReportStatus = updateReportStatus;
    window.deleteReport = deleteReport;
    
    // è¡¨å–®æäº¤è™•ç†
    document.getElementById('reportForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // æ”¶é›†è¡¨å–®è³‡æ–™
        const formData = new FormData(this);
        const data = {};
        for (let [key, value] of formData.entries()) {
            data[key] = value;
        }
        
        // å»ºæ§‹å®Œæ•´åœ°å€
        let fullAddress = 'è‡ºåŒ—å¸‚å¤§åŒå€' + (data.road || '');
        if (data.lane) fullAddress += data.lane + 'å··';
        if (data.alley) fullAddress += data.alley + 'å¼„';
        if (data.number) fullAddress += data.number + 'è™Ÿ';
        if (data.subnumber) fullAddress += 'ä¹‹' + data.subnumber;
        if (data.floor) fullAddress += data.floor + 'æ¨“';
        
        // ç”Ÿæˆé€šå ±ç·¨è™Ÿ
        const reportId = 'RPT' + Date.now().toString().slice(-8);
        
        // å„²å­˜åˆ° localStorage
        const reportData = {
            reportId: reportId,
            timestamp: new Date().toISOString(),
            status: 'å¾…è™•ç†',
            ...data,
            fullAddress: fullAddress
        };
        
        saveReportToStorage(reportData);
        
        // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
        const successMessage = document.getElementById('successMessage');
        successMessage.innerHTML = `
            <div class="text-2xl mb-2">âœ…</div>
            <div class="text-lg font-bold mb-1">å ±å‘Šæäº¤æˆåŠŸï¼</div>
            <div class="mb-2">é€šå ±ç·¨è™Ÿï¼š${reportId}</div>
            <div>è³‡æ–™å·²å„²å­˜åˆ°æœ¬åœ°ï¼Œå¯åœ¨ã€ŒæŸ¥çœ‹è¨˜éŒ„ã€ä¸­ç®¡ç†</div>
        `;
        successMessage.style.display = 'block';
        successMessage.scrollIntoView({ behavior: 'smooth' });
        
        // åœ¨æ§åˆ¶å°é¡¯ç¤ºå®Œæ•´è³‡æ–™
        console.log('é€šå ±è³‡æ–™å·²å„²å­˜:', reportData);
        
        // é‡ç½®è¡¨å–®
        setTimeout(() => {
            this.reset();
            // é‡æ–°è¨­å®šä»Šå¤©æ—¥æœŸ
            discoveryDate.value = today.toISOString().split('T')[0];
            // é‡ç½®åŒ¿åé€šå ±ç‹€æ…‹
            nameSection.style.display = 'block';
            nameSelect.setAttribute('required', '');
            // æ¸…é™¤ç…§ç‰‡é è¦½
            photoPreview.innerHTML = '';
            // ç§»é™¤ç·Šæ€¥ç¨‹åº¦æ¨£å¼
            document.querySelector('.section-divider').classList.remove('urgency-high', 'urgency-medium', 'urgency-low');
            
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 1000);
        }, 4000);
    });
    
    // è¡¨å–®é©—è­‰å¢å¼·
    const requiredFields = document.querySelectorAll('[required]');
    requiredFields.forEach(field => {
        field.addEventListener('blur', function() {
            if (!this.value.trim()) {
                this.style.borderColor = '#ef4444';
            } else {
                this.style.borderColor = '#10b981';
            }
        });
        
        field.addEventListener('input', function() {
            if (this.value.trim()) {
                this.style.borderColor = '#10b981';
            }
        });
    });
</script>

<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98495f72a2298282',t:'MTc1ODc5MTI2My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>